<script>
  async function loadProducts() {
    const grid = document.getElementById('products-grid');
    if (!grid) return;
    grid.innerHTML = "<p>Loading products...</p>";

    try {
      const res = await fetch("https://api.github.com/repos/SMcollection1/sm-collections/contents/products");
      const files = await res.json();

      grid.innerHTML = "";
      for (const file of files) {
        if (!file.name.endsWith(".md")) continue;
        const content = await fetch(file.download_url).then(r => r.text());

        const title = content.match(/title:\s*(.*)/)?.[1] || "Product";
        const description = content.match(/description:\s*(.*)/)?.[1] || "";
        const price = content.match(/price:\s*(.*)/)?.[1] || "";
        const image = content.match(/image:\s*(.*)/)?.[1] || "";
        const whatsapp = content.match(/whatsapp:\s*(.*)/)?.[1] || "#";
        <li><a href="cart.html">üõí View Cart</a></li>

        const card = document.createElement("div");
        card.className = "category-card";
        card.innerHTML = `
          <a href="product.html?file=${file.name}" style="text-decoration:none;color:inherit;">
            <img src="${image}" alt="${title}" style="width:100%;border-radius:10px;margin-bottom:1rem;">
            <h3>${title}</h3>
            <p>${description}</p>
            <p><strong>Price:</strong> ${price}</p>
          </a>
          <div style="margin-top:1rem;display:flex;gap:10px;justify-content:center;">
            <button class="category-btn" onclick="addToCart('${title}','${price}','${image}')">üõí Add to Cart</button>
            <a href="${whatsapp}" target="_blank" class="category-btn" style="background:#25d366;">üí¨ WhatsApp</a>
          </div>
        `;
        grid.appendChild(card);
      }
    } catch (err) {
      grid.innerHTML = "<p>Error loading products.</p>";
      console.error(err);
    }
  }

  function addToCart(title, price, image) {
    const cart = JSON.parse(localStorage.getItem("cart") || "[]");
    cart.push({ title, price, image });
    localStorage.setItem("cart", JSON.stringify(cart));
    alert(`${title} added to cart! üõç`);
  }

  loadProducts();
</script>
